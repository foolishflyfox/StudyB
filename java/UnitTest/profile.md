# 单元测试

## 为什么要写单元测试

- 允许你对代码作出任何改变，因为你了解单元测试会在你的预期之中；
- 可以有效降低程序出现bug的几率；
- 帮助你更深入地理解代码，因为在写单元测试的时候，你需要明确程序所有的执行流程及对应的执行结果等等；
- 允许你在任何时候重构代码，而不必担心破坏现有的代码。这使得我们编写程序更加灵活；
- 确保你的代码的健壮性，因为所有的测试都是通过了的；
- 文档记录；单元测试就是一种无价的文档，它是展示函数或类如何使用的最佳文档，这份文档是可编辑、可运行的，并且它保持最新，永远与代码同步。
- 具有回归性；自动化的单元测试避免了代码出现回归，编写完成之后，可以随时随地地快速运行测试，而不是将代码部署到设备之后，然后手动地覆盖各种执行路径。

## 什么时候写单测

写单测的时机不外乎三种：

1. 具体实现代码之前，这是测试驱动开发 TDD 所提倡的；
2. 与具体实现代码同步进行。先写少量功能代码，紧接着写单元测试(重复这个过程，知道完成功能代码开发)。其实这种方案和第一种很接近，基本上功能代码开发完，单元测试也差不多完成了；
3. 编写完功能代码后再写单元测试；

建议：方法2。

## 单元测试要多细

单元测试不是越多越好，而是越有效越好。例如符合下面特征的代码：

- 逻辑复杂的；
- 容易出错的；
- 不易理解的，即使是自己过段时间也会遗忘的，看不懂自己的代码，单元测试代码有助于理解代码的功能和需求；
- 公共代码，比如自定义的所有 http 请求都会经过的拦截器；工具类等；
- 核心业务代码，一个产品里最核心，最有业务价值的代码应该有较高的单元测试覆盖率；

